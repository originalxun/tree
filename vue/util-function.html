<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue3-工具函数 | 树之木</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="never give up">
    
    <link rel="preload" href="/tree-blod/assets/css/0.styles.12565279.css" as="style"><link rel="preload" href="/tree-blod/assets/js/app.c79a225f.js" as="script"><link rel="preload" href="/tree-blod/assets/js/2.6ca15a82.js" as="script"><link rel="preload" href="/tree-blod/assets/js/13.a492b3c4.js" as="script"><link rel="prefetch" href="/tree-blod/assets/js/10.013edf68.js"><link rel="prefetch" href="/tree-blod/assets/js/11.3fb9b15d.js"><link rel="prefetch" href="/tree-blod/assets/js/12.7d9d1341.js"><link rel="prefetch" href="/tree-blod/assets/js/3.98ae3056.js"><link rel="prefetch" href="/tree-blod/assets/js/4.4466df2d.js"><link rel="prefetch" href="/tree-blod/assets/js/5.02018b5a.js"><link rel="prefetch" href="/tree-blod/assets/js/6.bd7b0c2a.js"><link rel="prefetch" href="/tree-blod/assets/js/7.2c2a7d27.js"><link rel="prefetch" href="/tree-blod/assets/js/8.c02ba4af.js"><link rel="prefetch" href="/tree-blod/assets/js/9.02d545b6.js">
    <link rel="stylesheet" href="/tree-blod/assets/css/0.styles.12565279.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/tree-blod/" class="home-link router-link-active"><!----> <span class="site-name">树之木</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tree-blod/vue/" class="nav-link router-link-active">
  vue.js
</a></li><li class="dropdown-item"><!----> <a href="/tree-blod/node/" class="nav-link">
  node.js
</a></li><li class="dropdown-item"><!----> <a href="/tree-blod/vite/" class="nav-link">
  vite
</a></li><li class="dropdown-item"><!----> <a href="/tree-blod/npm/" class="nav-link">
  npm
</a></li><li class="dropdown-item"><!----> <a href="/tree-blod/react/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><a href="/tree-blod/js/" class="nav-link">
  javascript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tree-blod/java/" class="nav-link">
  java
</a></li><li class="dropdown-item"><!----> <a href="/tree-blod/spring/" class="nav-link">
  spring
</a></li></ul></div></div><div class="nav-item"><a href="/tree-blod/dbase/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/tree-blod/algorithm/" class="nav-link">
  数据结构和算法
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tree-blod/vue/" class="nav-link router-link-active">
  vue.js
</a></li><li class="dropdown-item"><!----> <a href="/tree-blod/node/" class="nav-link">
  node.js
</a></li><li class="dropdown-item"><!----> <a href="/tree-blod/vite/" class="nav-link">
  vite
</a></li><li class="dropdown-item"><!----> <a href="/tree-blod/npm/" class="nav-link">
  npm
</a></li><li class="dropdown-item"><!----> <a href="/tree-blod/react/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><a href="/tree-blod/js/" class="nav-link">
  javascript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tree-blod/java/" class="nav-link">
  java
</a></li><li class="dropdown-item"><!----> <a href="/tree-blod/spring/" class="nav-link">
  spring
</a></li></ul></div></div><div class="nav-item"><a href="/tree-blod/dbase/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/tree-blod/algorithm/" class="nav-link">
  数据结构和算法
</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue3-工具函数"><a href="#vue3-工具函数" class="header-anchor">#</a> vue3-工具函数</h1> <p>学习人：木木</p> <p>学习时间📅: 2022.01.09 2045:51</p> <p>学习地址：</p> <p>概述：</p> <ol><li>如何查看vue-next源码；</li> <li>vue-next中使用的工具函数；</li> <li>总结与期望</li></ol> <h2 id="准备"><a href="#准备" class="header-anchor">#</a> 准备</h2> <h3 id="打包构建代码"><a href="#打包构建代码" class="header-anchor">#</a> 打包构建代码</h3> <p>源码中该文件为ts文件，因为我自己暂时没有ts的基础。所以需要将ts文件转换为js文件。</p> <p>环境：node.js：12.22.5、npm：6.14.14</p> <p>下载玩vue-next文件后，在编译器中打开进入到vue-next目录中。输入命令</p> <div class="language-node extra-class"><pre class="language-text"><code>-- 构建包名为 shared 的目录（我们只需要运行这个命令）
npm run build shared 

-- 注：构建包名包含run-time的目录
npm run build run-time --all
</code></pre></div><p>构建完了之后会在shared目录下，新增一个dist目录。在目录中找到 shared.esm-bundle.js文件，这个就是我们想要得到的js文件。构建完了之后我们一起看一下该文件中的一些方法。</p> <p><img src="C:%5CUsers%5CPOET%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220109210426739.png" alt="image-20220109210426739"></p> <h3 id="生成source-map调试vue-next源码"><a href="#生成source-map调试vue-next源码" class="header-anchor">#</a> 生成source map调试vue-next源码</h3> <p><strong>为什么要用Source Map？</strong></p> <ul><li>源码进行压缩转换，减少文件数量</li> <li>减少http的请求次数</li> <li>减少文件的体积</li></ul> <p><strong>什么是Source Map？</strong></p> <blockquote><p>Source Map就是一个信息文件，里面存储着位置信息。可以理解为转换后的代码位置与转换前的代码位置之间的映射关系。</p></blockquote> <p>注：这样会让构建速度变慢。</p> <p>1.在命令行输入：</p> <div class="language-NODE extra-class"><pre class="language-text"><code>npm run dev:sourcemap
</code></pre></div><p>2.在vue-next目录下，找到package.json文件，在文件中的script出添加以下代码。这种方式需要手动再构建一次，将脚本生成。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string-property property">&quot;dev:sourcemap&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node scripts/dev.js --sourcemap&quot;</span>
</code></pre></div><p><img src="C:%5CUsers%5CPOET%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220109212045915.png" alt="image-20220109212045915"></p> <p>构建完了之后会生成一个vue.global.js的文件。</p> <p><img src="C:%5CUsers%5CPOET%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220109212307969.png" alt="image-20220109212307969"></p> <h2 id="工具函数"><a href="#工具函数" class="header-anchor">#</a> 工具函数</h2> <h3 id="_1-empty-obj-空对象"><a href="#_1-empty-obj-空对象" class="header-anchor">#</a> 1.EMPTY_OBJ --- 空对象</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">EMPTY_OBJ</span> <span class="token operator">=</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span>
    <span class="token operator">?</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Object.freeze（）方法可以<strong>冻结</strong>一个对象。一个被冻结的对象再也不能被修改；冻结了一个对象则不能向这个对象添加新的属性，也不能删除已有属性，不能修改该对象已有属性的可枚举性、可配置性、可写性，以及不能修改已有属性的值。此外，冻结一个对象后该对象的原型也不能被修改。freeze()返回和传入的参数相同的对象。</p></blockquote> <p>举个栗子 🌰</p> <div class="language- extra-class"><pre class="language-text"><code>var obj = {
  prop: function() {},
  foo: 'bar'
};

// 新的属性会被添加, 已存在的属性可能
// 会被修改或移除
obj.foo = 'baz';
obj.lumpy = 'woof';
delete obj.prop;

// 作为参数传递的对象与返回的对象都被冻结
// 所以不必保存返回的对象（因为两个对象全等）
var o = Object.freeze(obj);

o === obj; // true
Object.isFrozen(obj); // === true

// 现在任何改变都会失效
obj.foo = 'quux'; // 静默地不做任何事
// 静默地不添加此属性
obj.quaxxor = 'the friendly duck';
</code></pre></div><h3 id="_2-empty-arr-空数组"><a href="#_2-empty-arr-空数组" class="header-anchor">#</a> 2.EMPTY_ARR --- 空数组</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">EMPTY_ARR</span> <span class="token operator">=</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token operator">?</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-noop-空函数"><a href="#_3-noop-空函数" class="header-anchor">#</a> 3.NOOP --- 空函数</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">NOOP</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-no-永远返回false的函数"><a href="#_4-no-永远返回false的函数" class="header-anchor">#</a> 4.NO --- 永远返回false的函数</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * Always return false.
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">NO</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-ison-判断字符串是不是-on-开头-并且-on-后首字母不是小写字母"><a href="#_5-ison-判断字符串是不是-on-开头-并且-on-后首字母不是小写字母" class="header-anchor">#</a> 5.isON --- 判断字符串是不是 on 开头，并且 on 后首字母不是小写字母</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> onRE <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^on[^a-z]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">isOn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> onRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-ismodellistener-监听器"><a href="#_6-ismodellistener-监听器" class="header-anchor">#</a> 6.isModelListener --- 监听器</h3> <p>判断字符串是不是以onUpdate:开头</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">isModelListener</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> key<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'onUpdate:'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-extend-继承、合并"><a href="#_7-extend-继承、合并" class="header-anchor">#</a> 7.extend --- 继承、合并</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> extend <span class="token operator">=</span> Object<span class="token punctuation">.</span>assign<span class="token punctuation">;</span>
</code></pre></div><h3 id="_8-remove-移除数组中的一项"><a href="#_8-remove-移除数组中的一项" class="header-anchor">#</a> 8.remove --- 移除数组中的一项</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">remove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> i <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_9-hasownproperty-判断是否对象本身拥有的属性"><a href="#_9-hasownproperty-判断是否对象本身拥有的属性" class="header-anchor">#</a> 9.hasOwnProperty --- 判断是否对象本身拥有的属性</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> hasOwnProperty <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>hasOwnProperty<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasOwn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_10-isarra-判断数组"><a href="#_10-isarra-判断数组" class="header-anchor">#</a> 10.isArra --- 判断数组</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> isArray$1 <span class="token operator">=</span> Array<span class="token punctuation">.</span>isArray<span class="token punctuation">;</span>
</code></pre></div><h3 id="_11-ismap-判断是不是map对象"><a href="#_11-ismap-判断是不是map对象" class="header-anchor">#</a> 11.isMap --- 判断是不是Map对象</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">isMap$1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">toTypeString$1</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Map]'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_12-isset-判断是不是set对象"><a href="#_12-isset-判断是不是set对象" class="header-anchor">#</a> 12.isSet --- 判断是不是Set对象</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">isSet$1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">toTypeString$1</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Set]'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_13-isdate-判断是不是date-时间-对象"><a href="#_13-isdate-判断是不是date-时间-对象" class="header-anchor">#</a> 13.isDate --- 判断是不是Date(时间)对象</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">isDate$1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_14-isfunction-判断是不是函数"><a href="#_14-isfunction-判断是不是函数" class="header-anchor">#</a> 14.isFUnction --- 判断是不是函数</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">isFunction$1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_15-isstring-判断是不是字符串"><a href="#_15-isstring-判断是不是字符串" class="header-anchor">#</a> 15.isString --- 判断是不是字符串</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">isString$1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_16-issymbol-判断是不是symbol"><a href="#_16-issymbol-判断是不是symbol" class="header-anchor">#</a> 16.isSymbol --- 判断是不是Symbol</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">isSymbol</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'symbol'</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>ES6引入了一种新的原始数据类型Symbol，表示独一无二的值。</p></blockquote> <h3 id="_17-isobject-判断是不是对象"><a href="#_17-isobject-判断是不是对象" class="header-anchor">#</a> 17.isObject --- 判断是不是对象</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">isObject$1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_18-ispromise-判断是不是promise对象"><a href="#_18-ispromise-判断是不是promise对象" class="header-anchor">#</a> 18.isPromise --- 判断是不是Promise对象</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">isPromise</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">isObject$1</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFunction$1</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span>then<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFunction$1</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span>catch<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>含义：promise是异步编程的一种解决方案，比传统的解决方案-- 回调函数和时间，更加合理和强大。简单来说就是一个容器，里面保存着某个未来才会结束的时间（通常是一个异步操作）的结果。从语法上说，Promise是一个对象，从它可以获取异步操作的消息。</p> <p>特点：</p> <ul><li>对象的状态不受外界影响。</li> <li>一旦状态改变，就不会再变，任何时候都可以得到这个结果。</li></ul> <p>三种状态：</p> <ul><li>pending（进行中）、</li> <li>fulfilled（已成功）、</li> <li>rejected（已失败）</li></ul> <p>详细可以看ES6官网：https://es6.ruanyifeng.com/#docs/promise</p></blockquote> <h3 id="_19-objecttostring-对象转字符串"><a href="#_19-objecttostring-对象转字符串" class="header-anchor">#</a> 19.objectToString --- 对象转字符串</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> objectToString$1 <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">toTypeString$1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">objectToString$1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_20-torawtype-对象转字符串-截取后几位"><a href="#_20-torawtype-对象转字符串-截取后几位" class="header-anchor">#</a> 20.toRawType --- 对象转字符串 截取后几位</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">toRawType</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// extract &quot;RawType&quot; from strings like &quot;[object RawType]&quot;</span>
    <span class="token keyword">return</span> <span class="token function">toTypeString$1</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_21-isplainobject-判断是不是一个纯粹的对象"><a href="#_21-isplainobject-判断是不是一个纯粹的对象" class="header-anchor">#</a> 21.isPlainObject --- 判断是不是一个纯粹的对象</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">isPlainObject$1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">toTypeString$1</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Object]'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_22-isintegerkey-判断是不是数字型的字符串key值"><a href="#_22-isintegerkey-判断是不是数字型的字符串key值" class="header-anchor">#</a> 22.isIntegerKey --- 判断是不是数字型的字符串key值</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">isIntegerKey</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">isString$1</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    key <span class="token operator">!==</span> <span class="token string">'NaN'</span> <span class="token operator">&amp;&amp;</span>
    key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'-'</span> <span class="token operator">&amp;&amp;</span>
    <span class="token string">''</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">===</span> key<span class="token punctuation">;</span>
</code></pre></div><h3 id="_23-makemap-isreservedprop"><a href="#_23-makemap-isreservedprop" class="header-anchor">#</a> 23.makeMap &amp;&amp; isReservedProp</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> isReservedProp <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span> <span class="token function">makeMap</span><span class="token punctuation">(</span>
<span class="token comment">// the leading comma is intentional so empty string &quot;&quot; is also included</span>
<span class="token string">',key,ref,ref_for,ref_key,'</span> <span class="token operator">+</span>
    <span class="token string">'onVnodeBeforeMount,onVnodeMounted,'</span> <span class="token operator">+</span>
    <span class="token string">'onVnodeBeforeUpdate,onVnodeUpdated,'</span> <span class="token operator">+</span>
    <span class="token string">'onVnodeBeforeUnmount,onVnodeUnmounted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">makeMap</span><span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> expectsLowerCase</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> map <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        map<span class="token punctuation">[</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> expectsLowerCase <span class="token operator">?</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>map<span class="token punctuation">[</span>val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>map<span class="token punctuation">[</span>val<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote></blockquote> <p>传入一个以逗号分隔的字符串，生成一个map(键值对)，并且返回一个函数检测key值在不在这个map中。第二个参数是小写选型。</p> <h3 id="_24-cachestringfunction-缓存"><a href="#_24-cachestringfunction-缓存" class="header-anchor">#</a> 24.cacheStringFunction 缓存</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">cacheStringFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cache <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> hit <span class="token operator">=</span> cache<span class="token punctuation">[</span>str<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> hit <span class="token operator">||</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>str<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_25-haschanged-是否有改变"><a href="#_25-haschanged-是否有改变" class="header-anchor">#</a> 25.hasChanged --- 是否有改变</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">hasChanged</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_26-invokearrayfns-执行数组里的函数"><a href="#_26-invokearrayfns-执行数组里的函数" class="header-anchor">#</a> 26.invokeArrayFns --- 执行数组里的函数</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">invokeArrayFns</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fns<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fns<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_27-def-定义对象"><a href="#_27-def-定义对象" class="header-anchor">#</a> 27.def --- 定义对象</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">def</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        value
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Object.defineProperty可以说是一个非常重要的API（为什么呢?我还不知道）。</p> <p>Object.defineProperty()方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性，并返回此对象。</p> <p>注：应当直接在Object构造器对象上调用此方法， 而不是在任意一个Object类型的实例上调用。</p> <p>详细可看ES6官网：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty</p></blockquote> <h3 id="_28-tonumber-转换为数字"><a href="#_28-tonumber-转换为数字" class="header-anchor">#</a> 28.toNumber ---转换为数字</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">toNumber</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">?</span> val <span class="token operator">:</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_29-getglobalthis-全局对象"><a href="#_29-getglobalthis-全局对象" class="header-anchor">#</a> 29.getGlobalThis --- 全局对象</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> _globalThis<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">getGlobalThis</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>_globalThis <span class="token operator">||</span>
        <span class="token punctuation">(</span>_globalThis <span class="token operator">=</span>
            <span class="token keyword">typeof</span> globalThis <span class="token operator">!==</span> <span class="token string">'undefined'</span>
                <span class="token operator">?</span> globalThis
                <span class="token operator">:</span> <span class="token keyword">typeof</span> self <span class="token operator">!==</span> <span class="token string">'undefined'</span>
                    <span class="token operator">?</span> self
                    <span class="token operator">:</span> <span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span>
                        <span class="token operator">?</span> window
                        <span class="token operator">:</span> <span class="token keyword">typeof</span> global <span class="token operator">!==</span> <span class="token string">'undefined'</span>
                            <span class="token operator">?</span> global
                            <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="总结与期望"><a href="#总结与期望" class="header-anchor">#</a> 总结与期望</h2> <p>一周三次读源码任务赶在了周日的晚上十点多完成，还是有点捉急的。不过还是学到了一些新东西，对源码也有了更深的了解，再提起源码的时候也不会有畏惧心里。唯一不足的是，还是有点赶，并没有还认真的去专研其中的一些思想和写代码的思路。暂时没法将这些东西，与项目相融合。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/tree-blod/assets/js/app.c79a225f.js" defer></script><script src="/tree-blod/assets/js/2.6ca15a82.js" defer></script><script src="/tree-blod/assets/js/13.a492b3c4.js" defer></script>
  </body>
</html>
